@model Quanlinhahang_Staff.Models.HoaDon

@{
    ViewData["Title"] = $"Hóa Đơn #{Model.HoaDonID}";
    var returnUrl = ViewBag.ReturnUrl as string ?? Url.Action("Index");
}

<h2 class="mt-3">Hóa Đơn #@Model.HoaDonID</h2>
<hr />

<div class="row">
    <div class="col-md-5">
        <h5>Thông tin chung</h5>
        <dl class="row">

            <dt class="col-sm-5">Ngày lập</dt>
            <dd class="col-sm-7">@Model.NgayLap</dd>

            <dt class="col-sm-5">Trạng thái</dt>
            <dd class="col-sm-7">@Model.TrangThai?.TenTrangThai</dd>

            <dt class="col-sm-5">Hình thức thanh toán</dt>
            <dd class="col-sm-7">@Model.HinhThucThanhToan</dd>

            <dt class="col-sm-5">Mã Đặt bàn</dt>
            <dd class="col-sm-7">@Model.DatBan?.DatBanID</dd>

            <dt class="col-sm-5">Loại bàn / phòng</dt>
            <dd class="col-sm-7">
                @(Model.DatBan?.BanPhong?.LoaiBanPhong != null
                                ? Model.DatBan.BanPhong.LoaiBanPhong.TenLoai
                                : "Không yêu cầu")
            </dd>

            <dt class="col-sm-5">Nhân viên</dt>
            <dd class="col-sm-7">@Model.TaiKhoanID</dd>

        </dl>
    </div>

    <div class="col-md-7">
        <h5>Danh sách món</h5>
        <table class="table table-bordered table-sm">
            <thead class="table-light">
                <tr>
                    <th>Tên món</th>
                    <th class="text-end">SL</th>
                    <th class="text-end">Đơn giá</th>
                    <th class="text-end">Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.ChiTietHoaDons)
                {
                    <tr>
                        <td>@item.MonAn?.TenMon</td>
                        <td class="text-end">@item.SoLuong</td>
                        <td class="text-end">@item.DonGia.ToString("#,##0")</td>
                        <td class="text-end">@item.ThanhTien.ToString("#,##0")</td>
                    </tr>
                }
            </tbody>

            <tfoot class="table-light">
                @{
                    var subTotal = Model.ChiTietHoaDons.Sum(i => i.ThanhTien);
                    var vat = subTotal * 0.1m;
                    var finalTotal = (subTotal + vat) - Model.GiamGia - Model.DiemSuDung;
                    if (finalTotal < 0) finalTotal = 0;
                }
                <tr>
                    <td colspan="3" class="text-end">Tạm tính:</td>
                    <td class="text-end">@subTotal.ToString("#,##0")</td>
                </tr>
                <tr>
                    <td colspan="3" class="text-end">VAT (10%):</td>
                    <td class="text-end">@vat.ToString("#,##0")</td>
                </tr>

                @if (Model.GiamGia > 0)
                {
                    <tr>
                        <td colspan="3" class="text-end text-danger">Giảm giá:</td>
                        <td class="text-end text-danger">-@Model.GiamGia.ToString("#,##0")</td>
                    </tr>
                }
                @if (Model.DiemSuDung > 0)
                {
                    <tr>
                        <td colspan="3" class="text-end text-danger">Dùng điểm:</td>
                        <td class="text-end text-danger">-@Model.DiemSuDung.ToString("#,##0")</td>
                    </tr>
                }

                <tr class="h5">
                    <td colspan="3" class="text-end"><strong>Thành tiền:</strong></td>
                    <td class="text-end"><strong>@finalTotal.ToString("#,##0")</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<hr />

<div class="text-end">
    <a class="btn btn-secondary"
       href="@Url.Action("Index", new { status = ViewBag.Status })">
        Quay lại
    </a>

</div>
