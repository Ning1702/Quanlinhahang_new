@model Quanlinhahang_Admin.Models.MonAn

@{
    ViewData["Title"] = "Chỉnh sửa món ăn";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    .form-wrapper {
        max-width: 900px;
        margin: 40px auto;
        background: #fff;
        padding: 40px 60px;
        border-radius: 16px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
    }

        .form-wrapper h2 {
            text-align: center;
            font-weight: 700;
            color: #222;
            margin-bottom: 30px;
        }

    .preview-container {
        margin-top: 10px;
        text-align: center;
    }

        .preview-container img {
            max-width: 250px;
            border-radius: 10px;
            margin-top: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            object-fit: cover;
        }

    .btn-back {
        background-color: #28a745;
        color: white;
        font-weight: 600;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        transition: 0.2s;
    }

        .btn-back:hover {
            background-color: #218838;
            text-decoration: none;
            color: #fff;
        }
</style>

<div class="container">
    <a asp-area="Admin" asp-controller="MonAns" asp-action="Index" class="btn-back">
        <i class="fa fa-arrow-left"></i> Quay lại
    </a>

    <div class="form-wrapper">
        <h2>Chỉnh sửa món ăn</h2>

        <form id="editForm" asp-action="Edit" enctype="multipart/form-data">
            <input type="hidden" asp-for="MonAnID" />

            <div class="mb-3">
                <label class="form-label fw-semibold">Tên món</label>
                <input asp-for="TenMon" class="form-control" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Danh mục</label>
                <select asp-for="DanhMucID" class="form-select" asp-items="ViewBag.DanhMucID">
                    <option value="">-- Chọn danh mục --</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Đơn giá</label>
                <input asp-for="DonGia" class="form-control" type="number" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Trạng thái</label>
                <select asp-for="TrangThai" class="form-select" asp-items="ViewBag.TrangThaiList"></select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Hình ảnh món ăn</label>
                <input type="file" id="HinhAnh" name="HinhAnh" class="form-control" accept="image/*" onchange="previewEditImage(event)" />
                <div id="editImagePreview" class="preview-container">
                    @if (!string.IsNullOrEmpty(Model.HinhAnhURL))
                    {
                        <img src="@Url.Content(Model.HinhAnhURL)" alt="Ảnh món" id="currentImage" />
                    }
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Mô tả</label>
                <textarea asp-for="MoTa" class="form-control" rows="3"></textarea>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-4">Cập nhật</button>
                <a asp-action="Index" class="btn btn-secondary px-4">Hủy</a>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        Swal.fire({
            title: "Xác nhận cập nhật?",
            text: "Bạn có chắc chắn muốn lưu thay đổi này không?",
            icon: "question",
            showCancelButton: true,
            confirmButtonText: "Cập nhật",
            cancelButtonText: "Hủy"
        }).then((result) => {
            if (result.isConfirmed) {
                this.submit();
                Swal.fire({
                    icon: "success",
                    title: "Cập nhật món ăn thành công!",
                    showConfirmButton: false,
                    timer: 1500
                });
            }
        });
    });

    function previewEditImage(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('editImagePreview');
        preview.innerHTML = '';
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    }
</script>
